const storage=chrome.storage.local,hiddenChatsList=document.getElementById("hiddenContainer"),chatCounter=document.getElementById("chatCount");function toggleMethod(e,t){document.querySelectorAll(`.${e}`).forEach((r=>{r.addEventListener("click",(()=>{const s=r.getAttribute("data-chaturl");storage.get(null,(r=>{const o=r.messengerChats.findIndex((e=>e.chatURL===s)),a=r.messengerChats[o][t];if("toggleLock"===e&&a){if(r.preferences.userPassword){prompt("Type your password to unlock this chat:")===r.preferences.userPassword&&(r.messengerChats[o][t]=!1,storage.set(r))}}else r.messengerChats[o][t]=!a,storage.set(r)}))}))}))}function setPassword(e){if(e.preferences.userPassword){if(e.preferences.userPassword===prompt("Type your old password:")){let t=null;for(;!t||t.length<5;)t=prompt("Enter a new password. The password must be at least 5 characters long:"),t&&t.length>=5&&(e.preferences.userPassword=t,storage.set(e))}}else for(;!e.preferences.userPassword||e.preferences.userPassword.length<5;){let t=e.preferences.userPassword;t?t.length<5&&(t=prompt(`Your current password is '${t}'. The password must be at least 5 characters long:`)):t=prompt("You haven't set a password yet. The password must be at least 5 characters long:"),t&&t.length>=5&&(e.preferences.userPassword=t,storage.set(e))}}function isValidLink(e){return e.includes("https://www.facebook.com")||e.includes("https://www.messenger.com")}function getDateNow(){const e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}function themeToggle(){const e=document.getElementById("toggle-theme");storage.get(null,(t=>{let r=t.preferences.userTheme;"dark"===r&&(e.checked=!0,document.documentElement.classList.toggle("dark")),e.addEventListener("click",(()=>{document.documentElement.classList.toggle("dark");const e="dark"==r?"light":"dark";t.preferences.userTheme=e,storage.set(t)}))}))}function exportDataToJson(){storage.get(null,(e=>{const t=btoa(JSON.stringify(e,null,2)),r=new Blob([t],{type:"text/plain"}),s=URL.createObjectURL(r),o=document.createElement("a");o.href=s,o.download=`hidechat_userdata_${getDateNow()}.txt`,o.click(),URL.revokeObjectURL(r)}))}function importDataToStorage(e){const t=new FileReader;t.onerror=()=>{alert("Failed: Invalid / corrupted file")},t.readAsText(e),t.onload=e=>{try{const t=atob(e.target.result),r=JSON.parse(t);if("object"!=typeof r)return void alert("Failed: Invalid / corrupted file");confirm("This will overwrite your current data, confirm:")&&storage.set(r)}catch(e){alert("Failed: Invalid / corrupted file "+e.message)}}}