function updateData(){chrome.runtime.sendMessage({message:"updateChats"},(t=>{t&&storage.get(null,(e=>{const s=new Set(e.messengerChats.map((t=>t.chatURL)));t.forEach((t=>{if(s.has(t.url)){const s=e.messengerChats.findIndex((e=>e.chatURL===t.url));if(-1===s)return;e.messengerChats[s]={chatName:t.name,chatImg:t.img,chatURL:t.url,lastMsg:t.lastMsg,dateAdded:e.messengerChats[s].dateAdded,isHidden:e.messengerChats[s].isHidden,isLocked:e.messengerChats[s].isLocked,isPinned:e.messengerChats[s].isPinned,isObfuscated:e.messengerChats[s].isObfuscated}}})),storage.set(e)}))}))}function appendHiddenChats(t){let e="";return t.forEach(((t,s)=>{e+=`\n\t\t\t<li\n\t\t\t\tclass="group h-[5.5rem] px-3 flex items-center bg-gray-100 even:bg-gray-50 dark:bg-gray-800 dark:even:bg-gray-700 dark:hover:bg-gray-600 dark:text-gray-400 text-gray-600 justify-between hover:bg-gray-200">\n\t\t\t\t<header class="flex items-center">\n\t\t\t\t\t<img class="size-16 rounded-md mr-3 bg-gray-600" src="${t.chatImg}"/>\n\t\t\t\t\t<div class="max-w-44 flex-col flex justify-between">\n\t\t\t\t\t\t<a class="text-xs text-blue-600 truncate block dark:text-blue-400" href="https://www.messenger.com${t.chatURL}"\n\t\t\t\t\t\t\ttarget="_blank">\n\t\t\t\t\t\t\t<div class="flex gap-2 items-center">\n\t\t\t\t\t\t\t\t<h3 class="text-sm font-semibold truncate">${t.chatName}</h3>\n\t\t\t\t\t\t\t\t<span class="text-xs text-gray-400">- ${t.lastMsg} ago</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<span class="text-xs text-gray-400">Days hidden: ${getDaySince(t.dateAdded)}</span>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<div class="flex group-hover:gap-2 items-center mt-2">\n\t\t\t\t\t\t\t<button data-chaturl=${t.chatURL} title="Make chat hidden" class="toggleHide -ml-2 group-hover:-ml-0 transition-transform group-hover:scale-100 size-6 scale-[0.3] opacity-40 hover:opacity-100 p-1 rounded-full\n\t\t\t\t\t\t\t${t.isHidden?"bg-emerald-500":"bg-rose-500"}">\n\t\t\t\t\t\t\t\t<img class="size-full invisible group-hover:visible" src="../assets/visiblenot.svg"/>\n\t\t\t\t\t\t\t</button>\t\t\t\t\t\n\t\t\t\t\t\t\t<button data-chaturl=${t.chatURL} title="Pin chat to the top" class="togglePin transition-transform -ml-2 group-hover:-ml-0 group-hover:scale-100 size-6 scale-[0.3] opacity-40 hover:opacity-100 p-1 rounded-full\n\t\t\t\t\t\t\t${t.isPinned?"bg-emerald-500":"bg-rose-500"}">\n\t\t\t\t\t\t\t\t<img class="size-full invisible group-hover:visible" src="../assets/pin-off.svg" data-on="true">\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<button data-chaturl=${t.chatURL} title="Lock chat with password" class="toggleLock transition-transform -ml-2 group-hover:-ml-0 group-hover:scale-100 size-6 scale-[0.3] opacity-40 hover:opacity-100 p-1 rounded-full\n\t\t\t\t\t\t\t${t.isLocked?"bg-emerald-500":"bg-rose-500"}">\n\t\t\t\t\t\t\t\t<img class="size-full invisible group-hover:visible" src="../assets/lock-off.svg" data-on="true">\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<button data-chaturl=${t.chatURL} title="Blur or pixelate messages" class="toggleObf transition-transform -ml-2 group-hover:-ml-0 group-hover:scale-100 size-6 scale-[0.3] opacity-40 hover:opacity-100 p-1 rounded-full\n\t\t\t\t\t\t\t${t.isObfuscated?"bg-emerald-500":"bg-rose-500"}">\n\t\t\t\t\t\t\t\t<img class="size-full invisible group-hover:visible" src="../assets/blur-off.svg" data-on="true">\n\t\t\t\t\t\t\t</button>\t\t\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</header>\n\t\t\t</li>`})),e}function toggleHiddenAll(){document.getElementById("toggle-hiddenall").addEventListener("click",(()=>{chrome.tabs.query({active:!0,currentWindow:!0},(t=>{isValidLink(t[0].url)&&chrome.tabs.sendMessage(t[0].id,{message:"toggleHiddenAll"})}))}))}function getDaySince(t){return(new Date(getDateNow())-new Date(t))/864e5}storage.get(null,(t=>{themeToggle(),toggleHiddenAll(),updateData(),chatCounter.innerText=t.messengerChats.length,hiddenChatsList.innerHTML=appendHiddenChats(t.messengerChats),toggleMethod("toggleHide","isHidden"),toggleMethod("toggleObf","isObfuscated"),toggleMethod("toggleLock","isLocked"),toggleMethod("togglePin","isPinned")})),storage.onChanged.addListener((()=>{storage.get(null,(t=>{t.messengerChats.forEach(((e,s)=>{e.isHidden||e.isPinned||e.isLocked||e.isObfuscated||t.messengerChats.splice(s,1)})),storage.set(t),chatCounter.innerText=t.messengerChats.length,hiddenChatsList.innerHTML=appendHiddenChats(t.messengerChats),toggleMethod("toggleHide","isHidden"),toggleMethod("toggleObf","isObfuscated"),toggleMethod("toggleLock","isLocked"),toggleMethod("togglePin","isPinned")}))}));