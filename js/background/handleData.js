let storage=chrome.storage.local,preferenceData={obfMethod:{text:["opacity","flip"],image:["blur","pixelate"],blurIntensity:5,brightnessIntensity:.3},pinnedColor:"#162184",userTheme:"light",userPassword:""};function createContexts(){const e=["*://www.messenger.com/*","*://www.facebook.com/*"],t=["*://www.messenger.com/e2ee/t/*","*://www.messenger.com/t/*","*://www.facebook.com/messages/t/*","*://www.facebook.com/messages/e2ee/t/*"];chrome.contextMenus.create({id:"hidechatMain",title:"Hide Chat: Private Messenger",contexts:["link"],documentUrlPatterns:e,targetUrlPatterns:t}),chrome.contextMenus.create({id:"hideAllChatExcept",parentId:"hidechatMain",title:"Hide EVERYTHING except this chat",contexts:["link"],documentUrlPatterns:e,targetUrlPatterns:t}),chrome.contextMenus.create({id:"hideThisChat",parentId:"hidechatMain",title:"Hide THIS chat",contexts:["link"],documentUrlPatterns:e,targetUrlPatterns:t}),chrome.contextMenus.create({id:"pinThisChat",parentId:"hidechatMain",title:"Pin THIS chat",contexts:["link"],documentUrlPatterns:e,targetUrlPatterns:t}),chrome.contextMenus.create({id:"lockThisChat",parentId:"hidechatMain",title:"Lock THIS chat",contexts:["link"],documentUrlPatterns:e,targetUrlPatterns:t}),chrome.contextMenus.create({id:"obfuscateThisChat",parentId:"hidechatMain",title:"Obfuscate THIS chat",contexts:["link"],documentUrlPatterns:e,targetUrlPatterns:t})}function initStorage(){storage.get(null,(e=>{0===Object.keys(e).length?storage.set({preferences:preferenceData,messengerChats:[]}):e.hidden_chat&&(storage.clear(),storage.set({preferences:preferenceData,messengerChats:[]},(()=>{storage.get(null,(t=>{e.hidden_chat.forEach((e=>{t.messengerChats.push({chatName:e,chatImg:"#",chatURL:e,lastMsg:"#",dateAdded:getDateNow(),isHidden:!0,isLocked:!1,isPinned:!1,isObfuscated:!1})})),storage.set(t)}))})))}))}function getDateNow(){const e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}chrome.runtime.onMessage.addListener(((e,t,s)=>{switch(e.message){case"updateChats":return chrome.tabs.query({active:!0,currentWindow:!0},(e=>{(e[0]?.url.includes("https://www.facebook.com")||e[0]?.url.includes("https://www.messenger.com"))&&chrome.tabs.sendMessage(e[0].id,{message:"getAllChat"},(e=>{s(e)}))})),!0;default:break}})),chrome.runtime.onInstalled.addListener((()=>{initStorage(),createContexts()})),chrome.contextMenus.onClicked.addListener((e=>{switch(e.menuItemId){case"hideThisChat":chrome.tabs.query({active:!0,currentWindow:!0},(t=>{chrome.tabs.sendMessage(t[0].id,{message:"getThisChat",clickedChat:e.linkUrl},null,(e=>{storage.get(null,(t=>{const s=new Set(t.messengerChats.map((e=>e.chatURL)));if(s.has(e.url)){const s=t.messengerChats.findIndex((t=>t.chatURL===e.url));t.messengerChats[s]={chatName:e.name,chatImg:e.img,chatURL:e.url,lastMsg:e.lastMsg,dateAdded:getDateNow(),isHidden:!0,isLocked:t.messengerChats[s].isLocked,isPinned:t.messengerChats[s].isPinned,isObfuscated:t.messengerChats[s].isObfuscated},storage.set(t)}else t.messengerChats.push({chatName:e.name,chatImg:e.img,chatURL:e.url,lastMsg:e.lastMsg,dateAdded:getDateNow(),isHidden:!0,isLocked:!1,isPinned:!1,isObfuscated:!1}),storage.set(t)}))}))}));break;case"hideAllChatExcept":chrome.tabs.query({active:!0,currentWindow:!0},(t=>{chrome.tabs.sendMessage(t[0].id,{message:"getAllChat"},null,(t=>{storage.get(null,(s=>{const a=new Set(s.messengerChats.map((e=>e.chatURL))),n=e.linkUrl.replace("https://www.facebook.com/messages","").replace("https://www.messenger.com","");t.forEach((e=>{if(e.url!=n)if(a.has(e.url)){const t=s.messengerChats.findIndex((t=>t.chatURL===e.url));s.messengerChats[t]={chatName:e.name,chatImg:e.img,chatURL:e.url,lastMsg:e.lastMsg,dateAdded:getDateNow(),isHidden:!0,isLocked:s.messengerChats[t].isLocked,isPinned:s.messengerChats[t].isPinned,isObfuscated:s.messengerChats[t].isObfuscated}}else s.messengerChats.push({chatName:e.name,chatImg:e.img,chatURL:e.url,lastMsg:e.lastMsg,dateAdded:getDateNow(),isHidden:!0,isLocked:!1,isPinned:!1,isObfuscated:!1})})),storage.set(s)}))}))}));break;case"obfuscateThisChat":chrome.tabs.query({active:!0,currentWindow:!0},(t=>{chrome.tabs.sendMessage(t[0].id,{message:"getThisChat",clickedChat:e.linkUrl},null,(e=>{storage.get(null,(t=>{const s=new Set(t.messengerChats.map((e=>e.chatURL)));if(s.has(e.url)){const s=t.messengerChats.findIndex((t=>t.chatURL===e.url));t.messengerChats[s]={chatName:e.name,chatImg:e.img,chatURL:e.url,lastMsg:e.lastMsg,dateAdded:t.messengerChats[s].dateAdded,isHidden:t.messengerChats[s].isHidden,isLocked:t.messengerChats[s].isLocked,isPinned:t.messengerChats[s].isPinned,isObfuscated:!0},storage.set(t)}else t.messengerChats.push({chatName:e.name,chatImg:e.img,chatURL:e.url,lastMsg:e.lastMsg,dateAdded:getDateNow(),isHidden:!1,isLocked:!1,isPinned:!1,isObfuscated:!0}),storage.set(t)}))}))}));break;case"pinThisChat":chrome.tabs.query({active:!0,currentWindow:!0},(t=>{chrome.tabs.sendMessage(t[0].id,{message:"getThisChat",clickedChat:e.linkUrl},null,(e=>{storage.get(null,(t=>{const s=new Set(t.messengerChats.map((e=>e.chatURL)));if(s.has(e.url)){const s=t.messengerChats.findIndex((t=>t.chatURL===e.url));t.messengerChats[s]={chatName:e.name,chatImg:e.img,chatURL:e.url,lastMsg:e.lastMsg,dateAdded:t.messengerChats[s].dateAdded,isHidden:t.messengerChats[s].isHidden,isLocked:t.messengerChats[s].isLocked,isPinned:!0,isObfuscated:t.messengerChats[s].isObfuscated},storage.set(t)}else t.messengerChats.push({chatName:e.name,chatImg:e.img,chatURL:e.url,lastMsg:e.lastMsg,dateAdded:getDateNow(),isHidden:!1,isLocked:!1,isPinned:!0,isObfuscated:!1}),storage.set(t)}))}))}));break;case"lockThisChat":chrome.tabs.query({active:!0,currentWindow:!0},(t=>{chrome.tabs.sendMessage(t[0].id,{message:"getThisChat",clickedChat:e.linkUrl},null,(e=>{storage.get(null,(t=>{const s=new Set(t.messengerChats.map((e=>e.chatURL)));if(s.has(e.url)){const s=t.messengerChats.findIndex((t=>t.chatURL===e.url));t.messengerChats[s]={chatName:e.name,chatImg:e.img,chatURL:e.url,lastMsg:e.lastMsg,dateAdded:t.messengerChats[s].dateAdded,isHidden:t.messengerChats[s].isHidden,isLocked:!0,isPinned:t.messengerChats[s].isPinned,isObfuscated:t.messengerChats[s].isObfuscated},storage.set(t)}else t.messengerChats.push({chatName:e.name,chatImg:e.img,chatURL:e.url,lastMsg:e.lastMsg,dateAdded:getDateNow(),isHidden:!1,isLocked:!0,isPinned:!1,isObfuscated:!1}),storage.set(t)}))}))}));break;default:break}}));