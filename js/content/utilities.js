const storage=chrome.storage.local;let isMessenger=location.origin.includes("https://www.messenger.com")||location.href.includes("https://www.facebook.com/messages"),isFacebook=location.origin.includes("https://www.facebook.com"),SELECTORS={CHATCONTAINER:"div[class='x1n2onr6']",MESSAGECONTAINER:"div[class='x78zum5 xdt5ytf x1iyjqo2 x2lah0s xl56j7k x121v3j4']",INBOXDETAIL:"div[class='x78zum5 xdt5ytf x1iyjqo2 xs83m0k x1n2onr6']",INBOXDETAILRIGHT:"div[class='x78zum5 x5yr21d xmz0i5r']",VIRTUALIZED:"div[data-virtualized='false']",MESSAGEROW:"div[data-scope='messages_table']",CHATLINK:"a",TEXT:"div[dir='auto']",TEXTSPAN:"span[dir='auto']",TEXTSPANHIDDEN:"span[aria-hidden='true']",STICKERS:"div[role='img']",REPLYTEXT:"div[class='xi81zsa x126k92a']",VIDEO:"video",AIMG:"a > img",DIVIMG:"div > img"};function getAllChat(){const e=document.querySelectorAll(`${SELECTORS.CHATCONTAINER} ${SELECTORS.VIRTUALIZED} ${SELECTORS.CHATLINK}`);if(!e)return null;const t=[];return e.forEach((e=>{const r=getChatInfo(e);r&&t.push(r)})),0===t.length?null:t}function getChatInfo(e){const t=getChatId(e.href),r=e.querySelector("img")?.src,n=e.querySelector(SELECTORS.TEXTSPAN)?.innerText,o=e.querySelectorAll(`${SELECTORS.TEXTSPAN} ${SELECTORS.TEXTSPANHIDDEN}`)[1]?.innerText;return o||(o="#"),{url:t,img:r,name:n,lastMsg:o}}function getChatByUrl(e){const t=document.querySelector(`${SELECTORS.CHATCONTAINER} a[href="${isFacebook?"/messages":""}${getChatId(e)}"]`);if(t)return t}function getCurrentChat(){let e=Array.from(location.href);return"/"!==e[location.href.length-1]&&(e[location.href.length]="/"),getChatId(e.join(""))}function getChatId(e){return e.replace("https://www.facebook.com/messages","").replace("https://www.messenger.com","").replace("/requests","").replace("/archived","").replace("/marketplace","")}function whenAvail(e,t,r={interval:.5,timeout:60}){let{interval:n,timeout:o}=r,a=!0;const s=setInterval((()=>{e()&&(clearInterval(s),a=!1,t())}),1e3*n);setTimeout((()=>{a&&clearInterval(s)}),1e3*o)}function onUrlChanged(e){let t=location.href;setInterval((()=>{location.href!==t&&(e(),t=location.href)}),500)}function hexToRgb(e){e=e.replace("#","");return`rgb(${parseInt(e.substring("0","2"),16)}, ${parseInt(e.substring("2","4"),16)}, ${parseInt(e.substring("4","6"),16)})`}(()=>{for(const[e,t]of Object.entries(SELECTORS));})();